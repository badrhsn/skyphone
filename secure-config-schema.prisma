// Enhanced Prisma schema with encrypted configuration storage
// Add this to your existing schema.prisma

model ApiConfiguration {
  id          String   @id @default(cuid())
  provider    String   @unique // "twilio", "stripe", "google_oauth", etc.
  configData  String   // JSON string with encrypted sensitive data
  isActive    Boolean  @default(true)
  environment String   @default("production") // "development", "staging", "production"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  lastUsed    DateTime?
  
  // Metadata for configuration management
  version     String   @default("1.0")
  description String?
  
  @@index([provider])
  @@index([environment])
}

model ConfigurationAudit {
  id              String   @id @default(cuid())
  configurationId String
  action          String   // "created", "updated", "accessed", "rotated"
  userId          String?  // Who made the change
  previousValue   String?  // Encrypted previous value (for rollback)
  metadata        String?  // JSON with additional context
  ipAddress       String?
  userAgent       String?
  createdAt       DateTime @default(now())
  
  user User? @relation(fields: [userId], references: [id])
  
  @@index([configurationId])
  @@index([action])
  @@index([createdAt])
}